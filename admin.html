<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin Console</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; }
    header {
      display: flex; justify-content: space-between; align-items: center;
      background: #34495e; color: white; padding: 12px 20px;
    }
    header h2 { margin: 0; font-size: 1.2rem; }
    .user-menu { position: relative; cursor: pointer; }
    .user-name { display: flex; align-items: center; gap: 6px; }
    .dropdown {
      position: absolute; right: 0; top: 120%;
      background: white; color: #333; border: 1px solid #ddd; border-radius: 4px;
      min-width: 150px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      display: none; flex-direction: column; z-index: 10;
    }
    .dropdown a { padding: 10px; text-decoration: none; color: #333; font-size: 0.9rem; }
    .dropdown a:hover { background: #f0f0f0; }
    .user-menu.open .dropdown { display: flex; }

    main { padding: 20px; }
    .card { border: 1px solid #eee; border-radius: 8px; padding: 16px; max-width: 420px; }
    .card h3 { margin-top: 0; }
    .btn {
      display: inline-block;
      padding: 10px 15px;
      background: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>

  <script>
    const LOGIN_PAGE = './login.html';

    function isTokenValid(token) {
      if (!token) return false;
      const p = parseJwt(token);
      if (!p || !p.exp) return true;
      return p.exp * 1000 > Date.now();
    }
    function parseJwt(token) {
      try { return JSON.parse(atob(token.split('.')[1])); } catch { return null; }
    }

    (async function guard() {
      const token = localStorage.getItem('token');
      const email = localStorage.getItem('userEmail');

      if (!isTokenValid(token) || email !== 'root@paddemy.com') {
        localStorage.removeItem('token');
        localStorage.removeItem('userEmail');
        window.location.replace(LOGIN_PAGE + '?reason=required');
      }
    })();
  </script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
  function AdminPage() {
    const [user, setUser] = React.useState(null);
    const [menuOpen, setMenuOpen] = React.useState(false);

    function hardLogout() {
      localStorage.removeItem("token");
      localStorage.removeItem("userEmail");
      window.location.replace("login.html?reason=required");
    }

    React.useEffect(() => {
      const email = localStorage.getItem("userEmail");
      setUser({ email });
    }, []);

    return (
        <div>
          <header>
            <h2>Admin Console</h2>
            <div className={`user-menu ${menuOpen ? "open" : ""}`} onClick={() => setMenuOpen(!menuOpen)}>
              <div className="user-name">
                <span>{user ? user.email : "..."}</span>
                <span>▾</span>
              </div>
              <div className="dropdown">
                <a href="#" onClick={hardLogout}>Cerrar sesión</a>
              </div>
            </div>
          </header>

          <main>
            <div className="card">
              <h3>Panel de Administración</h3>
              <p>Aquí puedes gestionar las diferentes funciones de la plataforma.</p>
              <a href="registrar-academia.html" className="btn">Registrar nueva academia</a>
              <a href="registrar-miembro.html" className="btn">Registrar nuevo miembro</a>
            </div>
          </main>
        </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById("root"));
  root.render(<AdminPage />);
</script>
</body>
</html>
